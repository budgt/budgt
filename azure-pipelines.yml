trigger:
- feature/*

pool:
  vmImage: 'ubuntu-latest'

stages:
- stage: 'Prepare'
  jobs:
  - job: 'Prepare_Sonarcloud_Environment'
    steps:
    - task: SonarCloudPrepare@1
      inputs:
        SonarCloud: 'sonarcloud'
        organization: 'pahofmann-gitlab'
        scannerMode: 'CLI'
        configMode: 'file'
- stage: 'Unit_Test'
  jobs:
  - job: 'category_service'
    steps:
    - task: Gradle@1
      displayName: category service
      inputs:
        gradleWrapperFile: 'gradlew'
        workingDirectory: '$(Build.SourcesDirectory)/backend/category-service/'
        tasks: 'clean test jacocoTestReport'
        publishJUnitResults: false
        sonarQubeRunAnalysis: false
    - task: PublishCodeCoverageResults@1
      displayName: Publish Coverage Results
      inputs:
        codeCoverageTool: 'JaCoCo'
        summaryFileLocation: '**/build/reports/jacoco/jacocoRootReport/jacocoRootReport.xml'
        reportDirectory: '**/build/reports/jacoco/jacocoRootReport/html'
- stage: sonar_scan
  jobs:
  - job: 'category_service'
    steps:
    - task: SonarCloudAnalyze@1
- stage: Compile
  jobs:
  - job: 'categoryS_srvice'
    steps:
    - task: Gradle@2
      inputs:
        gradleWrapperFile: 'gradlew'
        workingDirectory: '$(Build.SourcesDirectory)/backend/category-service/'
        tasks: 'build'
        publishJUnitResults: false
        sonarQubeRunAnalysis: false

